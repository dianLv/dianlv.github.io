[{"data":1,"prerenderedAt":1988},["ShallowReactive",2],{"/articles/code-segment":3},{"id":4,"title":5,"body":6,"category":1979,"description":1980,"extension":1981,"lastModified":1982,"meta":1983,"navigation":140,"path":1984,"seo":1985,"stem":1986,"__hash__":1987},"articles/articles/Code-Segment.md","代码片段",{"type":7,"value":8,"toc":1975},"minimal",[9,14,21,256,261,1939,1943,1948,1971],[10,11,13],"h3",{"id":12},"lua","Lua",[15,16,17],"ul",{},[18,19,20],"li",{},"在不修改原 lua 的基础上, 访问 local 内容",[22,23,27],"pre",{"className":24,"code":25,"language":12,"meta":26,"style":26},"language-lua shiki shiki-themes github-dark github-light","function module(module_name, local_string)\n  local path = package.searchpath(module_name, package.path)\n  local f = io.open(path, \"r\")\n  local content = f:read(\"*a\")\n  f:close()\n\n  -- 修改content, 在lua的最后面加入local\n  content = content .. local_string or ''\n\n  local chunk, err = load(content, \"@\" .. path)\n  if not chunk then error(err) end\n\n  return chunk()\nend\n\n-- local x, y, z = module(\"x.y.z\", ', local_var_1, local_var_2')\n","",[28,29,30,47,72,94,121,135,142,149,171,176,200,224,229,240,245,250],"code",{"__ignoreMap":26},[31,32,35,39,43],"span",{"class":33,"line":34},"line",1,[31,36,38],{"class":37},"scx8i","function",[31,40,42],{"class":41},"s-Z4r"," module",[31,44,46],{"class":45},"sQ3_J","(module_name, local_string)\n",[31,48,50,53,56,59,63,66,69],{"class":33,"line":49},2,[31,51,52],{"class":37},"  local",[31,54,55],{"class":45}," path ",[31,57,58],{"class":37},"=",[31,60,62],{"class":61},"s0DvM"," package.searchpath",[31,64,65],{"class":45},"(module_name, ",[31,67,68],{"class":61},"package.path",[31,70,71],{"class":45},")\n",[31,73,75,77,80,82,85,88,92],{"class":33,"line":74},3,[31,76,52],{"class":37},[31,78,79],{"class":45}," f ",[31,81,58],{"class":37},[31,83,84],{"class":61}," io.open",[31,86,87],{"class":45},"(path, ",[31,89,91],{"class":90},"sg6BJ","\"r\"",[31,93,71],{"class":45},[31,95,97,99,102,104,107,110,113,116,119],{"class":33,"line":96},4,[31,98,52],{"class":37},[31,100,101],{"class":45}," content ",[31,103,58],{"class":37},[31,105,106],{"class":41}," f",[31,108,109],{"class":45},":",[31,111,112],{"class":61},"read",[31,114,115],{"class":45},"(",[31,117,118],{"class":90},"\"*a\"",[31,120,71],{"class":45},[31,122,124,127,129,132],{"class":33,"line":123},5,[31,125,126],{"class":41},"  f",[31,128,109],{"class":45},[31,130,131],{"class":61},"close",[31,133,134],{"class":45},"()\n",[31,136,138],{"class":33,"line":137},6,[31,139,141],{"emptyLinePlaceholder":140},true,"\n",[31,143,145],{"class":33,"line":144},7,[31,146,148],{"class":147},"sryI4","  -- 修改content, 在lua的最后面加入local\n",[31,150,152,155,157,159,162,165,168],{"class":33,"line":151},8,[31,153,154],{"class":45},"  content ",[31,156,58],{"class":37},[31,158,101],{"class":45},[31,160,161],{"class":37},"..",[31,163,164],{"class":45}," local_string ",[31,166,167],{"class":37},"or",[31,169,170],{"class":90}," ''\n",[31,172,174],{"class":33,"line":173},9,[31,175,141],{"emptyLinePlaceholder":140},[31,177,179,181,184,186,189,192,195,197],{"class":33,"line":178},10,[31,180,52],{"class":37},[31,182,183],{"class":45}," chunk, err ",[31,185,58],{"class":37},[31,187,188],{"class":61}," load",[31,190,191],{"class":45},"(content, ",[31,193,194],{"class":90},"\"@\" ",[31,196,161],{"class":37},[31,198,199],{"class":45}," path)\n",[31,201,203,206,209,212,215,218,221],{"class":33,"line":202},11,[31,204,205],{"class":37},"  if",[31,207,208],{"class":37}," not",[31,210,211],{"class":45}," chunk ",[31,213,214],{"class":37},"then",[31,216,217],{"class":61}," error",[31,219,220],{"class":45},"(err) ",[31,222,223],{"class":37},"end\n",[31,225,227],{"class":33,"line":226},12,[31,228,141],{"emptyLinePlaceholder":140},[31,230,232,235,238],{"class":33,"line":231},13,[31,233,234],{"class":37},"  return",[31,236,237],{"class":61}," chunk",[31,239,134],{"class":45},[31,241,243],{"class":33,"line":242},14,[31,244,223],{"class":37},[31,246,248],{"class":33,"line":247},15,[31,249,141],{"emptyLinePlaceholder":140},[31,251,253],{"class":33,"line":252},16,[31,254,255],{"class":147},"-- local x, y, z = module(\"x.y.z\", ', local_var_1, local_var_2')\n",[15,257,258],{},[18,259,260],{},"dump 一个 table 中的(非 local)变量、函数信息",[22,262,264],{"className":24,"code":263,"language":12,"meta":26,"style":26},"-- 采集全部信息, 包括 var、func、{} 等\nfunction collect_all(tbl)\n    local result = {}\n\n    for name, val in pairs(tbl) do\n        result[name] = {\n            field = val,\n            class = type(val),\n            source = 'table'\n        }\n    end\n\n    -- 元表部分\n    local mt = getmetatable(tbl)\n    if mt and type(mt.__index) == \"table\" then\n        for name, val in pairs(mt.__index) do\n            -- 排除掉已使用的\n            if result[name] == nil then\n                result[name] = {\n                    field = val,\n                    class = type(val),\n                    source = 'metatable'\n                }\n            end\n        end\n    end\n\n    return result\nend\n\n-- 只采集函数信息\nfunction collect_all_functions(tbl)\n    local result = {}\n\n    -- 记录 table 自身的函数\n    for name, func in pairs(tbl) do\n        if type(func) == \"function\" then\n            result[name] = {\n                field = func,\n                class = 'function',\n                source = 'table'\n            }\n        end\n    end\n\n    -- 如果有 metatable 且 __index 是 table，也记录其中的函数, 排除重复内容\n    local mt = getmetatable(tbl)\n    if mt and type(mt.__index) == \"table\" then\n        for name, func in pairs(mt.__index) do\n            if type(func) == \"function\" and result[name] == nil then\n                result[name] = {\n                    field = func,\n                    class = 'function',\n                    source = 'metatable'\n                }\n            end\n        end\n    end\n\n    return result\nend\n\n-- 通过debug获取必要信息\nfunction get_function_signature(name, entry)\n    -- *的是通过元表继承\n    local source = entry.source == 'table' and \" \" or \"*\"\n    local func = entry.field\n\n    -- u: 参数个数等，S: 来源信息\n    local info = debug.getinfo(func, \"uS\")\n    local params = {}\n\n    -- 参数\n    for i = 1, info.nparams do\n        local param_name = debug.getlocal(func, i)\n        table.insert(params, param_name or (\"arg\" .. i))\n    end\n\n    -- 可变参数\n    if info.isvararg then\n        table.insert(params, \"...\")\n    end\n\n    return string.format(\"%s function %s(%s)\", source, name, table.concat(params, \", \"))\nend\n\nfunction get_string_signature(name, entry)\n    local source = entry.source == 'table' and \" \" or \"*\"\n    local str = entry.field\n\n    return string.format(\"%s string %s = '%s'\", source, name, str)\nend\n\nfunction get_value_signature(name, entry)\n    local source = entry.source == 'table' and \" \" or \"*\"\n    local class = entry.class\n    local value = tostring(entry.field)\n\n    return string.format(\"%s %s %s = %s\", source, class, name, value)\nend\n\n-- 递归遍历\nfunction get_table_signature(name, entry)\n    local source = entry.source == 'table' and \" \" or \"*\"\n\n    return string.format(\"%s table %s = {}\", source, name)\nend\n\n-- 这里排序就不根据类型做区分了\nfunction sorted_names(entries)\n    local names = {}\n    for name, _ in pairs(entries) do\n        table.insert(names, name)\n    end\n    table.sort(names)\n    return names\nend\n\nfunction generate(tbl)\n    local entries = collect_all(tbl)\n    local lines = {}\n\n    local sorted_names = sorted_names(entries)\n\n    local handles = {\n        [\"function\"] = get_function_signature,\n        [\"string\"] = get_string_signature,\n        [\"number\"] = get_value_signature,\n        [\"boolean\"] = get_value_signature,\n        [\"table\"] = get_table_signature,\n    }\n\n    for _, name in pairs(sorted_names) do\n        local entry = entries[name]\n\n        local handle = handles[entry.class]\n\n        if handle then\n            local sig = handle(name, entry)\n            table.insert(lines, sig)\n        else\n            -- 通常是 userdata, thread\n            print(\"!! _未知类型_\" .. entry.class)\n        end\n    end\n\n    return table.concat(lines, \"\\n\")\nend\n\n-- 从入参中获取模块名称\nfunction do_generate()\n    local module_name = arg[1] or 'x.y.z'\n    local tbl = require(module_name)\n    local doc = generate(tbl)\n    local f = io.open(module_name .. \".txt\", \"w\")\n    f:write(doc)\n    f:close()\nend\n--- 调用前, 还需要处理引入一些必要信息, 如class、动态添加的内容...\ndo_generate()\n",[28,265,266,271,281,294,298,318,328,338,351,361,366,371,375,380,394,424,443,449,466,476,486,498,509,515,521,527,532,537,546,551,556,562,572,583,588,594,610,628,638,649,663,673,679,684,689,694,700,713,736,755,778,787,796,807,816,821,826,831,836,841,848,853,858,864,875,881,913,928,933,939,960,972,977,983,1005,1022,1044,1049,1054,1060,1073,1086,1091,1096,1123,1128,1133,1143,1168,1182,1187,1202,1207,1212,1222,1247,1262,1283,1288,1303,1308,1313,1319,1329,1354,1359,1374,1379,1384,1390,1401,1413,1430,1438,1443,1452,1460,1465,1470,1480,1494,1506,1511,1525,1530,1542,1559,1574,1589,1603,1618,1624,1629,1646,1659,1664,1683,1688,1697,1713,1722,1728,1734,1753,1758,1763,1768,1789,1794,1799,1805,1815,1838,1854,1868,1895,1909,1920,1925,1931],{"__ignoreMap":26},[31,267,268],{"class":33,"line":34},[31,269,270],{"class":147},"-- 采集全部信息, 包括 var、func、{} 等\n",[31,272,273,275,278],{"class":33,"line":49},[31,274,38],{"class":37},[31,276,277],{"class":41}," collect_all",[31,279,280],{"class":45},"(tbl)\n",[31,282,283,286,289,291],{"class":33,"line":74},[31,284,285],{"class":37},"    local",[31,287,288],{"class":45}," result ",[31,290,58],{"class":37},[31,292,293],{"class":45}," {}\n",[31,295,296],{"class":33,"line":96},[31,297,141],{"emptyLinePlaceholder":140},[31,299,300,303,306,309,312,315],{"class":33,"line":123},[31,301,302],{"class":37},"    for",[31,304,305],{"class":45}," name, val ",[31,307,308],{"class":37},"in",[31,310,311],{"class":61}," pairs",[31,313,314],{"class":45},"(tbl) ",[31,316,317],{"class":37},"do\n",[31,319,320,323,325],{"class":33,"line":137},[31,321,322],{"class":45},"        result[name] ",[31,324,58],{"class":37},[31,326,327],{"class":45}," {\n",[31,329,330,333,335],{"class":33,"line":144},[31,331,332],{"class":45},"            field ",[31,334,58],{"class":37},[31,336,337],{"class":45}," val,\n",[31,339,340,343,345,348],{"class":33,"line":151},[31,341,342],{"class":45},"            class ",[31,344,58],{"class":37},[31,346,347],{"class":61}," type",[31,349,350],{"class":45},"(val),\n",[31,352,353,356,358],{"class":33,"line":173},[31,354,355],{"class":45},"            source ",[31,357,58],{"class":37},[31,359,360],{"class":90}," 'table'\n",[31,362,363],{"class":33,"line":178},[31,364,365],{"class":45},"        }\n",[31,367,368],{"class":33,"line":202},[31,369,370],{"class":37},"    end\n",[31,372,373],{"class":33,"line":226},[31,374,141],{"emptyLinePlaceholder":140},[31,376,377],{"class":33,"line":231},[31,378,379],{"class":147},"    -- 元表部分\n",[31,381,382,384,387,389,392],{"class":33,"line":242},[31,383,285],{"class":37},[31,385,386],{"class":45}," mt ",[31,388,58],{"class":37},[31,390,391],{"class":61}," getmetatable",[31,393,280],{"class":45},[31,395,396,399,401,404,406,409,412,415,418,421],{"class":33,"line":247},[31,397,398],{"class":37},"    if",[31,400,386],{"class":45},[31,402,403],{"class":37},"and",[31,405,347],{"class":61},[31,407,408],{"class":45},"(mt.",[31,410,411],{"class":41},"__index",[31,413,414],{"class":45},") ",[31,416,417],{"class":37},"==",[31,419,420],{"class":90}," \"table\" ",[31,422,423],{"class":37},"then\n",[31,425,426,429,431,433,435,437,439,441],{"class":33,"line":252},[31,427,428],{"class":37},"        for",[31,430,305],{"class":45},[31,432,308],{"class":37},[31,434,311],{"class":61},[31,436,408],{"class":45},[31,438,411],{"class":41},[31,440,414],{"class":45},[31,442,317],{"class":37},[31,444,446],{"class":33,"line":445},17,[31,447,448],{"class":147},"            -- 排除掉已使用的\n",[31,450,452,455,458,460,463],{"class":33,"line":451},18,[31,453,454],{"class":37},"            if",[31,456,457],{"class":45}," result[name] ",[31,459,417],{"class":37},[31,461,462],{"class":61}," nil",[31,464,465],{"class":37}," then\n",[31,467,469,472,474],{"class":33,"line":468},19,[31,470,471],{"class":45},"                result[name] ",[31,473,58],{"class":37},[31,475,327],{"class":45},[31,477,479,482,484],{"class":33,"line":478},20,[31,480,481],{"class":45},"                    field ",[31,483,58],{"class":37},[31,485,337],{"class":45},[31,487,489,492,494,496],{"class":33,"line":488},21,[31,490,491],{"class":45},"                    class ",[31,493,58],{"class":37},[31,495,347],{"class":61},[31,497,350],{"class":45},[31,499,501,504,506],{"class":33,"line":500},22,[31,502,503],{"class":45},"                    source ",[31,505,58],{"class":37},[31,507,508],{"class":90}," 'metatable'\n",[31,510,512],{"class":33,"line":511},23,[31,513,514],{"class":45},"                }\n",[31,516,518],{"class":33,"line":517},24,[31,519,520],{"class":37},"            end\n",[31,522,524],{"class":33,"line":523},25,[31,525,526],{"class":37},"        end\n",[31,528,530],{"class":33,"line":529},26,[31,531,370],{"class":37},[31,533,535],{"class":33,"line":534},27,[31,536,141],{"emptyLinePlaceholder":140},[31,538,540,543],{"class":33,"line":539},28,[31,541,542],{"class":37},"    return",[31,544,545],{"class":45}," result\n",[31,547,549],{"class":33,"line":548},29,[31,550,223],{"class":37},[31,552,554],{"class":33,"line":553},30,[31,555,141],{"emptyLinePlaceholder":140},[31,557,559],{"class":33,"line":558},31,[31,560,561],{"class":147},"-- 只采集函数信息\n",[31,563,565,567,570],{"class":33,"line":564},32,[31,566,38],{"class":37},[31,568,569],{"class":41}," collect_all_functions",[31,571,280],{"class":45},[31,573,575,577,579,581],{"class":33,"line":574},33,[31,576,285],{"class":37},[31,578,288],{"class":45},[31,580,58],{"class":37},[31,582,293],{"class":45},[31,584,586],{"class":33,"line":585},34,[31,587,141],{"emptyLinePlaceholder":140},[31,589,591],{"class":33,"line":590},35,[31,592,593],{"class":147},"    -- 记录 table 自身的函数\n",[31,595,597,599,602,604,606,608],{"class":33,"line":596},36,[31,598,302],{"class":37},[31,600,601],{"class":45}," name, func ",[31,603,308],{"class":37},[31,605,311],{"class":61},[31,607,314],{"class":45},[31,609,317],{"class":37},[31,611,613,616,618,621,623,626],{"class":33,"line":612},37,[31,614,615],{"class":37},"        if",[31,617,347],{"class":61},[31,619,620],{"class":45},"(func) ",[31,622,417],{"class":37},[31,624,625],{"class":90}," \"function\" ",[31,627,423],{"class":37},[31,629,631,634,636],{"class":33,"line":630},38,[31,632,633],{"class":45},"            result[name] ",[31,635,58],{"class":37},[31,637,327],{"class":45},[31,639,641,644,646],{"class":33,"line":640},39,[31,642,643],{"class":45},"                field ",[31,645,58],{"class":37},[31,647,648],{"class":45}," func,\n",[31,650,652,655,657,660],{"class":33,"line":651},40,[31,653,654],{"class":45},"                class ",[31,656,58],{"class":37},[31,658,659],{"class":90}," 'function'",[31,661,662],{"class":45},",\n",[31,664,666,669,671],{"class":33,"line":665},41,[31,667,668],{"class":45},"                source ",[31,670,58],{"class":37},[31,672,360],{"class":90},[31,674,676],{"class":33,"line":675},42,[31,677,678],{"class":45},"            }\n",[31,680,682],{"class":33,"line":681},43,[31,683,526],{"class":37},[31,685,687],{"class":33,"line":686},44,[31,688,370],{"class":37},[31,690,692],{"class":33,"line":691},45,[31,693,141],{"emptyLinePlaceholder":140},[31,695,697],{"class":33,"line":696},46,[31,698,699],{"class":147},"    -- 如果有 metatable 且 __index 是 table，也记录其中的函数, 排除重复内容\n",[31,701,703,705,707,709,711],{"class":33,"line":702},47,[31,704,285],{"class":37},[31,706,386],{"class":45},[31,708,58],{"class":37},[31,710,391],{"class":61},[31,712,280],{"class":45},[31,714,716,718,720,722,724,726,728,730,732,734],{"class":33,"line":715},48,[31,717,398],{"class":37},[31,719,386],{"class":45},[31,721,403],{"class":37},[31,723,347],{"class":61},[31,725,408],{"class":45},[31,727,411],{"class":41},[31,729,414],{"class":45},[31,731,417],{"class":37},[31,733,420],{"class":90},[31,735,423],{"class":37},[31,737,739,741,743,745,747,749,751,753],{"class":33,"line":738},49,[31,740,428],{"class":37},[31,742,601],{"class":45},[31,744,308],{"class":37},[31,746,311],{"class":61},[31,748,408],{"class":45},[31,750,411],{"class":41},[31,752,414],{"class":45},[31,754,317],{"class":37},[31,756,758,760,762,764,766,768,770,772,774,776],{"class":33,"line":757},50,[31,759,454],{"class":37},[31,761,347],{"class":61},[31,763,620],{"class":45},[31,765,417],{"class":37},[31,767,625],{"class":90},[31,769,403],{"class":37},[31,771,457],{"class":45},[31,773,417],{"class":37},[31,775,462],{"class":61},[31,777,465],{"class":37},[31,779,781,783,785],{"class":33,"line":780},51,[31,782,471],{"class":45},[31,784,58],{"class":37},[31,786,327],{"class":45},[31,788,790,792,794],{"class":33,"line":789},52,[31,791,481],{"class":45},[31,793,58],{"class":37},[31,795,648],{"class":45},[31,797,799,801,803,805],{"class":33,"line":798},53,[31,800,491],{"class":45},[31,802,58],{"class":37},[31,804,659],{"class":90},[31,806,662],{"class":45},[31,808,810,812,814],{"class":33,"line":809},54,[31,811,503],{"class":45},[31,813,58],{"class":37},[31,815,508],{"class":90},[31,817,819],{"class":33,"line":818},55,[31,820,514],{"class":45},[31,822,824],{"class":33,"line":823},56,[31,825,520],{"class":37},[31,827,829],{"class":33,"line":828},57,[31,830,526],{"class":37},[31,832,834],{"class":33,"line":833},58,[31,835,370],{"class":37},[31,837,839],{"class":33,"line":838},59,[31,840,141],{"emptyLinePlaceholder":140},[31,842,844,846],{"class":33,"line":843},60,[31,845,542],{"class":37},[31,847,545],{"class":45},[31,849,851],{"class":33,"line":850},61,[31,852,223],{"class":37},[31,854,856],{"class":33,"line":855},62,[31,857,141],{"emptyLinePlaceholder":140},[31,859,861],{"class":33,"line":860},63,[31,862,863],{"class":147},"-- 通过debug获取必要信息\n",[31,865,867,869,872],{"class":33,"line":866},64,[31,868,38],{"class":37},[31,870,871],{"class":41}," get_function_signature",[31,873,874],{"class":45},"(name, entry)\n",[31,876,878],{"class":33,"line":877},65,[31,879,880],{"class":147},"    -- *的是通过元表继承\n",[31,882,884,886,889,891,894,897,900,903,905,908,910],{"class":33,"line":883},66,[31,885,285],{"class":37},[31,887,888],{"class":45}," source ",[31,890,58],{"class":37},[31,892,893],{"class":45}," entry.",[31,895,896],{"class":41},"source",[31,898,899],{"class":37}," ==",[31,901,902],{"class":90}," 'table' ",[31,904,403],{"class":37},[31,906,907],{"class":90}," \" \" ",[31,909,167],{"class":37},[31,911,912],{"class":90}," \"*\"\n",[31,914,916,918,921,923,925],{"class":33,"line":915},67,[31,917,285],{"class":37},[31,919,920],{"class":45}," func ",[31,922,58],{"class":37},[31,924,893],{"class":45},[31,926,927],{"class":41},"field\n",[31,929,931],{"class":33,"line":930},68,[31,932,141],{"emptyLinePlaceholder":140},[31,934,936],{"class":33,"line":935},69,[31,937,938],{"class":147},"    -- u: 参数个数等，S: 来源信息\n",[31,940,942,944,947,949,952,955,958],{"class":33,"line":941},70,[31,943,285],{"class":37},[31,945,946],{"class":45}," info ",[31,948,58],{"class":37},[31,950,951],{"class":61}," debug.getinfo",[31,953,954],{"class":45},"(func, ",[31,956,957],{"class":90},"\"uS\"",[31,959,71],{"class":45},[31,961,963,965,968,970],{"class":33,"line":962},71,[31,964,285],{"class":37},[31,966,967],{"class":45}," params ",[31,969,58],{"class":37},[31,971,293],{"class":45},[31,973,975],{"class":33,"line":974},72,[31,976,141],{"emptyLinePlaceholder":140},[31,978,980],{"class":33,"line":979},73,[31,981,982],{"class":147},"    -- 参数\n",[31,984,986,988,991,993,996,999,1002],{"class":33,"line":985},74,[31,987,302],{"class":37},[31,989,990],{"class":45}," i ",[31,992,58],{"class":37},[31,994,995],{"class":61}," 1",[31,997,998],{"class":45},", info.",[31,1000,1001],{"class":41},"nparams",[31,1003,1004],{"class":37}," do\n",[31,1006,1008,1011,1014,1016,1019],{"class":33,"line":1007},75,[31,1009,1010],{"class":37},"        local",[31,1012,1013],{"class":45}," param_name ",[31,1015,58],{"class":37},[31,1017,1018],{"class":61}," debug.getlocal",[31,1020,1021],{"class":45},"(func, i)\n",[31,1023,1025,1028,1031,1033,1036,1039,1041],{"class":33,"line":1024},76,[31,1026,1027],{"class":61},"        table.insert",[31,1029,1030],{"class":45},"(params, param_name ",[31,1032,167],{"class":37},[31,1034,1035],{"class":45}," (",[31,1037,1038],{"class":90},"\"arg\" ",[31,1040,161],{"class":37},[31,1042,1043],{"class":45}," i))\n",[31,1045,1047],{"class":33,"line":1046},77,[31,1048,370],{"class":37},[31,1050,1052],{"class":33,"line":1051},78,[31,1053,141],{"emptyLinePlaceholder":140},[31,1055,1057],{"class":33,"line":1056},79,[31,1058,1059],{"class":147},"    -- 可变参数\n",[31,1061,1063,1065,1068,1071],{"class":33,"line":1062},80,[31,1064,398],{"class":37},[31,1066,1067],{"class":45}," info.",[31,1069,1070],{"class":41},"isvararg",[31,1072,465],{"class":37},[31,1074,1076,1078,1081,1084],{"class":33,"line":1075},81,[31,1077,1027],{"class":61},[31,1079,1080],{"class":45},"(params, ",[31,1082,1083],{"class":90},"\"...\"",[31,1085,71],{"class":45},[31,1087,1089],{"class":33,"line":1088},82,[31,1090,370],{"class":37},[31,1092,1094],{"class":33,"line":1093},83,[31,1095,141],{"emptyLinePlaceholder":140},[31,1097,1099,1101,1104,1106,1109,1112,1115,1117,1120],{"class":33,"line":1098},84,[31,1100,542],{"class":37},[31,1102,1103],{"class":61}," string.format",[31,1105,115],{"class":45},[31,1107,1108],{"class":90},"\"%s function %s(%s)\"",[31,1110,1111],{"class":45},", source, name, ",[31,1113,1114],{"class":61},"table.concat",[31,1116,1080],{"class":45},[31,1118,1119],{"class":90},"\", \"",[31,1121,1122],{"class":45},"))\n",[31,1124,1126],{"class":33,"line":1125},85,[31,1127,223],{"class":37},[31,1129,1131],{"class":33,"line":1130},86,[31,1132,141],{"emptyLinePlaceholder":140},[31,1134,1136,1138,1141],{"class":33,"line":1135},87,[31,1137,38],{"class":37},[31,1139,1140],{"class":41}," get_string_signature",[31,1142,874],{"class":45},[31,1144,1146,1148,1150,1152,1154,1156,1158,1160,1162,1164,1166],{"class":33,"line":1145},88,[31,1147,285],{"class":37},[31,1149,888],{"class":45},[31,1151,58],{"class":37},[31,1153,893],{"class":45},[31,1155,896],{"class":41},[31,1157,899],{"class":37},[31,1159,902],{"class":90},[31,1161,403],{"class":37},[31,1163,907],{"class":90},[31,1165,167],{"class":37},[31,1167,912],{"class":90},[31,1169,1171,1173,1176,1178,1180],{"class":33,"line":1170},89,[31,1172,285],{"class":37},[31,1174,1175],{"class":45}," str ",[31,1177,58],{"class":37},[31,1179,893],{"class":45},[31,1181,927],{"class":41},[31,1183,1185],{"class":33,"line":1184},90,[31,1186,141],{"emptyLinePlaceholder":140},[31,1188,1190,1192,1194,1196,1199],{"class":33,"line":1189},91,[31,1191,542],{"class":37},[31,1193,1103],{"class":61},[31,1195,115],{"class":45},[31,1197,1198],{"class":90},"\"%s string %s = '%s'\"",[31,1200,1201],{"class":45},", source, name, str)\n",[31,1203,1205],{"class":33,"line":1204},92,[31,1206,223],{"class":37},[31,1208,1210],{"class":33,"line":1209},93,[31,1211,141],{"emptyLinePlaceholder":140},[31,1213,1215,1217,1220],{"class":33,"line":1214},94,[31,1216,38],{"class":37},[31,1218,1219],{"class":41}," get_value_signature",[31,1221,874],{"class":45},[31,1223,1225,1227,1229,1231,1233,1235,1237,1239,1241,1243,1245],{"class":33,"line":1224},95,[31,1226,285],{"class":37},[31,1228,888],{"class":45},[31,1230,58],{"class":37},[31,1232,893],{"class":45},[31,1234,896],{"class":41},[31,1236,899],{"class":37},[31,1238,902],{"class":90},[31,1240,403],{"class":37},[31,1242,907],{"class":90},[31,1244,167],{"class":37},[31,1246,912],{"class":90},[31,1248,1250,1252,1255,1257,1259],{"class":33,"line":1249},96,[31,1251,285],{"class":37},[31,1253,1254],{"class":45}," class ",[31,1256,58],{"class":37},[31,1258,893],{"class":45},[31,1260,1261],{"class":41},"class\n",[31,1263,1265,1267,1270,1272,1275,1278,1281],{"class":33,"line":1264},97,[31,1266,285],{"class":37},[31,1268,1269],{"class":45}," value ",[31,1271,58],{"class":37},[31,1273,1274],{"class":61}," tostring",[31,1276,1277],{"class":45},"(entry.",[31,1279,1280],{"class":41},"field",[31,1282,71],{"class":45},[31,1284,1286],{"class":33,"line":1285},98,[31,1287,141],{"emptyLinePlaceholder":140},[31,1289,1291,1293,1295,1297,1300],{"class":33,"line":1290},99,[31,1292,542],{"class":37},[31,1294,1103],{"class":61},[31,1296,115],{"class":45},[31,1298,1299],{"class":90},"\"%s %s %s = %s\"",[31,1301,1302],{"class":45},", source, class, name, value)\n",[31,1304,1306],{"class":33,"line":1305},100,[31,1307,223],{"class":37},[31,1309,1311],{"class":33,"line":1310},101,[31,1312,141],{"emptyLinePlaceholder":140},[31,1314,1316],{"class":33,"line":1315},102,[31,1317,1318],{"class":147},"-- 递归遍历\n",[31,1320,1322,1324,1327],{"class":33,"line":1321},103,[31,1323,38],{"class":37},[31,1325,1326],{"class":41}," get_table_signature",[31,1328,874],{"class":45},[31,1330,1332,1334,1336,1338,1340,1342,1344,1346,1348,1350,1352],{"class":33,"line":1331},104,[31,1333,285],{"class":37},[31,1335,888],{"class":45},[31,1337,58],{"class":37},[31,1339,893],{"class":45},[31,1341,896],{"class":41},[31,1343,899],{"class":37},[31,1345,902],{"class":90},[31,1347,403],{"class":37},[31,1349,907],{"class":90},[31,1351,167],{"class":37},[31,1353,912],{"class":90},[31,1355,1357],{"class":33,"line":1356},105,[31,1358,141],{"emptyLinePlaceholder":140},[31,1360,1362,1364,1366,1368,1371],{"class":33,"line":1361},106,[31,1363,542],{"class":37},[31,1365,1103],{"class":61},[31,1367,115],{"class":45},[31,1369,1370],{"class":90},"\"%s table %s = {}\"",[31,1372,1373],{"class":45},", source, name)\n",[31,1375,1377],{"class":33,"line":1376},107,[31,1378,223],{"class":37},[31,1380,1382],{"class":33,"line":1381},108,[31,1383,141],{"emptyLinePlaceholder":140},[31,1385,1387],{"class":33,"line":1386},109,[31,1388,1389],{"class":147},"-- 这里排序就不根据类型做区分了\n",[31,1391,1393,1395,1398],{"class":33,"line":1392},110,[31,1394,38],{"class":37},[31,1396,1397],{"class":41}," sorted_names",[31,1399,1400],{"class":45},"(entries)\n",[31,1402,1404,1406,1409,1411],{"class":33,"line":1403},111,[31,1405,285],{"class":37},[31,1407,1408],{"class":45}," names ",[31,1410,58],{"class":37},[31,1412,293],{"class":45},[31,1414,1416,1418,1421,1423,1425,1428],{"class":33,"line":1415},112,[31,1417,302],{"class":37},[31,1419,1420],{"class":45}," name, _ ",[31,1422,308],{"class":37},[31,1424,311],{"class":61},[31,1426,1427],{"class":45},"(entries) ",[31,1429,317],{"class":37},[31,1431,1433,1435],{"class":33,"line":1432},113,[31,1434,1027],{"class":61},[31,1436,1437],{"class":45},"(names, name)\n",[31,1439,1441],{"class":33,"line":1440},114,[31,1442,370],{"class":37},[31,1444,1446,1449],{"class":33,"line":1445},115,[31,1447,1448],{"class":61},"    table.sort",[31,1450,1451],{"class":45},"(names)\n",[31,1453,1455,1457],{"class":33,"line":1454},116,[31,1456,542],{"class":37},[31,1458,1459],{"class":45}," names\n",[31,1461,1463],{"class":33,"line":1462},117,[31,1464,223],{"class":37},[31,1466,1468],{"class":33,"line":1467},118,[31,1469,141],{"emptyLinePlaceholder":140},[31,1471,1473,1475,1478],{"class":33,"line":1472},119,[31,1474,38],{"class":37},[31,1476,1477],{"class":41}," generate",[31,1479,280],{"class":45},[31,1481,1483,1485,1488,1490,1492],{"class":33,"line":1482},120,[31,1484,285],{"class":37},[31,1486,1487],{"class":45}," entries ",[31,1489,58],{"class":37},[31,1491,277],{"class":61},[31,1493,280],{"class":45},[31,1495,1497,1499,1502,1504],{"class":33,"line":1496},121,[31,1498,285],{"class":37},[31,1500,1501],{"class":45}," lines ",[31,1503,58],{"class":37},[31,1505,293],{"class":45},[31,1507,1509],{"class":33,"line":1508},122,[31,1510,141],{"emptyLinePlaceholder":140},[31,1512,1514,1516,1519,1521,1523],{"class":33,"line":1513},123,[31,1515,285],{"class":37},[31,1517,1518],{"class":45}," sorted_names ",[31,1520,58],{"class":37},[31,1522,1397],{"class":61},[31,1524,1400],{"class":45},[31,1526,1528],{"class":33,"line":1527},124,[31,1529,141],{"emptyLinePlaceholder":140},[31,1531,1533,1535,1538,1540],{"class":33,"line":1532},125,[31,1534,285],{"class":37},[31,1536,1537],{"class":45}," handles ",[31,1539,58],{"class":37},[31,1541,327],{"class":45},[31,1543,1545,1548,1551,1554,1556],{"class":33,"line":1544},126,[31,1546,1547],{"class":45},"        [",[31,1549,1550],{"class":90},"\"function\"",[31,1552,1553],{"class":45},"] ",[31,1555,58],{"class":37},[31,1557,1558],{"class":45}," get_function_signature,\n",[31,1560,1562,1564,1567,1569,1571],{"class":33,"line":1561},127,[31,1563,1547],{"class":45},[31,1565,1566],{"class":90},"\"string\"",[31,1568,1553],{"class":45},[31,1570,58],{"class":37},[31,1572,1573],{"class":45}," get_string_signature,\n",[31,1575,1577,1579,1582,1584,1586],{"class":33,"line":1576},128,[31,1578,1547],{"class":45},[31,1580,1581],{"class":90},"\"number\"",[31,1583,1553],{"class":45},[31,1585,58],{"class":37},[31,1587,1588],{"class":45}," get_value_signature,\n",[31,1590,1592,1594,1597,1599,1601],{"class":33,"line":1591},129,[31,1593,1547],{"class":45},[31,1595,1596],{"class":90},"\"boolean\"",[31,1598,1553],{"class":45},[31,1600,58],{"class":37},[31,1602,1588],{"class":45},[31,1604,1606,1608,1611,1613,1615],{"class":33,"line":1605},130,[31,1607,1547],{"class":45},[31,1609,1610],{"class":90},"\"table\"",[31,1612,1553],{"class":45},[31,1614,58],{"class":37},[31,1616,1617],{"class":45}," get_table_signature,\n",[31,1619,1621],{"class":33,"line":1620},131,[31,1622,1623],{"class":45},"    }\n",[31,1625,1627],{"class":33,"line":1626},132,[31,1628,141],{"emptyLinePlaceholder":140},[31,1630,1632,1634,1637,1639,1641,1644],{"class":33,"line":1631},133,[31,1633,302],{"class":37},[31,1635,1636],{"class":45}," _, name ",[31,1638,308],{"class":37},[31,1640,311],{"class":61},[31,1642,1643],{"class":45},"(sorted_names) ",[31,1645,317],{"class":37},[31,1647,1649,1651,1654,1656],{"class":33,"line":1648},134,[31,1650,1010],{"class":37},[31,1652,1653],{"class":45}," entry ",[31,1655,58],{"class":37},[31,1657,1658],{"class":45}," entries[name]\n",[31,1660,1662],{"class":33,"line":1661},135,[31,1663,141],{"emptyLinePlaceholder":140},[31,1665,1667,1669,1672,1674,1677,1680],{"class":33,"line":1666},136,[31,1668,1010],{"class":37},[31,1670,1671],{"class":45}," handle ",[31,1673,58],{"class":37},[31,1675,1676],{"class":45}," handles[entry.",[31,1678,1679],{"class":41},"class",[31,1681,1682],{"class":45},"]\n",[31,1684,1686],{"class":33,"line":1685},137,[31,1687,141],{"emptyLinePlaceholder":140},[31,1689,1691,1693,1695],{"class":33,"line":1690},138,[31,1692,615],{"class":37},[31,1694,1671],{"class":45},[31,1696,423],{"class":37},[31,1698,1700,1703,1706,1708,1711],{"class":33,"line":1699},139,[31,1701,1702],{"class":37},"            local",[31,1704,1705],{"class":45}," sig ",[31,1707,58],{"class":37},[31,1709,1710],{"class":61}," handle",[31,1712,874],{"class":45},[31,1714,1716,1719],{"class":33,"line":1715},140,[31,1717,1718],{"class":61},"            table.insert",[31,1720,1721],{"class":45},"(lines, sig)\n",[31,1723,1725],{"class":33,"line":1724},141,[31,1726,1727],{"class":37},"        else\n",[31,1729,1731],{"class":33,"line":1730},142,[31,1732,1733],{"class":147},"            -- 通常是 userdata, thread\n",[31,1735,1737,1740,1742,1745,1747,1749,1751],{"class":33,"line":1736},143,[31,1738,1739],{"class":61},"            print",[31,1741,115],{"class":45},[31,1743,1744],{"class":90},"\"!! _未知类型_\" ",[31,1746,161],{"class":37},[31,1748,893],{"class":45},[31,1750,1679],{"class":41},[31,1752,71],{"class":45},[31,1754,1756],{"class":33,"line":1755},144,[31,1757,526],{"class":37},[31,1759,1761],{"class":33,"line":1760},145,[31,1762,370],{"class":37},[31,1764,1766],{"class":33,"line":1765},146,[31,1767,141],{"emptyLinePlaceholder":140},[31,1769,1771,1773,1776,1779,1782,1785,1787],{"class":33,"line":1770},147,[31,1772,542],{"class":37},[31,1774,1775],{"class":61}," table.concat",[31,1777,1778],{"class":45},"(lines, ",[31,1780,1781],{"class":90},"\"",[31,1783,1784],{"class":61},"\\n",[31,1786,1781],{"class":90},[31,1788,71],{"class":45},[31,1790,1792],{"class":33,"line":1791},148,[31,1793,223],{"class":37},[31,1795,1797],{"class":33,"line":1796},149,[31,1798,141],{"emptyLinePlaceholder":140},[31,1800,1802],{"class":33,"line":1801},150,[31,1803,1804],{"class":147},"-- 从入参中获取模块名称\n",[31,1806,1808,1810,1813],{"class":33,"line":1807},151,[31,1809,38],{"class":37},[31,1811,1812],{"class":41}," do_generate",[31,1814,134],{"class":45},[31,1816,1818,1820,1823,1825,1828,1831,1833,1835],{"class":33,"line":1817},152,[31,1819,285],{"class":37},[31,1821,1822],{"class":45}," module_name ",[31,1824,58],{"class":37},[31,1826,1827],{"class":45}," arg[",[31,1829,1830],{"class":61},"1",[31,1832,1553],{"class":45},[31,1834,167],{"class":37},[31,1836,1837],{"class":90}," 'x.y.z'\n",[31,1839,1841,1843,1846,1848,1851],{"class":33,"line":1840},153,[31,1842,285],{"class":37},[31,1844,1845],{"class":45}," tbl ",[31,1847,58],{"class":37},[31,1849,1850],{"class":61}," require",[31,1852,1853],{"class":45},"(module_name)\n",[31,1855,1857,1859,1862,1864,1866],{"class":33,"line":1856},154,[31,1858,285],{"class":37},[31,1860,1861],{"class":45}," doc ",[31,1863,58],{"class":37},[31,1865,1477],{"class":61},[31,1867,280],{"class":45},[31,1869,1871,1873,1875,1877,1879,1882,1884,1887,1890,1893],{"class":33,"line":1870},155,[31,1872,285],{"class":37},[31,1874,79],{"class":45},[31,1876,58],{"class":37},[31,1878,84],{"class":61},[31,1880,1881],{"class":45},"(module_name ",[31,1883,161],{"class":37},[31,1885,1886],{"class":90}," \".txt\"",[31,1888,1889],{"class":45},", ",[31,1891,1892],{"class":90},"\"w\"",[31,1894,71],{"class":45},[31,1896,1898,1901,1903,1906],{"class":33,"line":1897},156,[31,1899,1900],{"class":41},"    f",[31,1902,109],{"class":45},[31,1904,1905],{"class":61},"write",[31,1907,1908],{"class":45},"(doc)\n",[31,1910,1912,1914,1916,1918],{"class":33,"line":1911},157,[31,1913,1900],{"class":41},[31,1915,109],{"class":45},[31,1917,131],{"class":61},[31,1919,134],{"class":45},[31,1921,1923],{"class":33,"line":1922},158,[31,1924,223],{"class":37},[31,1926,1928],{"class":33,"line":1927},159,[31,1929,1930],{"class":147},"--- 调用前, 还需要处理引入一些必要信息, 如class、动态添加的内容...\n",[31,1932,1934,1937],{"class":33,"line":1933},160,[31,1935,1936],{"class":61},"do_generate",[31,1938,134],{"class":45},[10,1940,1942],{"id":1941},"android","Android",[15,1944,1945],{},[18,1946,1947],{},"临时解决 frida-server 报错",[22,1949,1953],{"className":1950,"code":1951,"language":1952,"meta":26,"style":26},"language-bash shiki shiki-themes github-dark github-light","# Error: Unable to perform state transition; please file a bug\npm uninstall com.google.android.art\n","bash",[28,1954,1955,1960],{"__ignoreMap":26},[31,1956,1957],{"class":33,"line":34},[31,1958,1959],{"class":147},"# Error: Unable to perform state transition; please file a bug\n",[31,1961,1962,1965,1968],{"class":33,"line":49},[31,1963,1964],{"class":41},"pm",[31,1966,1967],{"class":90}," uninstall",[31,1969,1970],{"class":90}," com.google.android.art\n",[1972,1973,1974],"style",{},"html pre.shiki code .scx8i, html code.shiki .scx8i{--shiki-dark:#F97583;--shiki-default:#D73A49}html pre.shiki code .s-Z4r, html code.shiki .s-Z4r{--shiki-dark:#B392F0;--shiki-default:#6F42C1}html pre.shiki code .sQ3_J, html code.shiki .sQ3_J{--shiki-dark:#E1E4E8;--shiki-default:#24292E}html pre.shiki code .s0DvM, html code.shiki .s0DvM{--shiki-dark:#79B8FF;--shiki-default:#005CC5}html pre.shiki code .sg6BJ, html code.shiki .sg6BJ{--shiki-dark:#9ECBFF;--shiki-default:#032F62}html pre.shiki code .sryI4, html code.shiki .sryI4{--shiki-dark:#6A737D;--shiki-default:#6A737D}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}",{"title":26,"searchDepth":74,"depth":74,"links":1976},[1977,1978],{"id":12,"depth":74,"text":13},{"id":1941,"depth":74,"text":1942},"code, lua, frida","记录在逆向过程中写的一些代码, 搜集的命令。","md","2025-5-6",{},"/articles/code-segment",{"title":5,"description":1980},"articles/Code-Segment","g1nDnZ1JXtBnrdYro9Fp6g6rS79wRQCQRAAUgkplCNA",1746600038509]